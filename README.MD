# ğŸš€ Affiliate Strategist Pro (Django)

Plataforma de anÃ¡lisis y generaciÃ³n de estrategias de marketing con IA.

DiseÃ±ada para desplegarse rÃ¡pidamente en Railway (PaaS), con soporte para PostgreSQL o SQLite y archivos estÃ¡ticos servidos con WhiteNoise.

---

## âœ… Estado y versiones
- Python: 3.11.x
- Django: 5.2.x
- Servidor: Gunicorn + WhiteNoise
- IA: Google Generative AI (Gemini)

---

## ğŸ“ Estructura del repositorio
```
.
â”œâ”€â”€ manage.py                  # Entry point de Django
â”œâ”€â”€ config/                    # Proyecto Django (urls, settings, wsgi)
â”‚   â”œâ”€â”€ settings.py            # Config principal (usa SQLite si no hay PG)
â”‚   â”œâ”€â”€ urls.py
â”‚   â””â”€â”€ wsgi.py
â”œâ”€â”€ analyzer/                  # App principal
â”‚   â”œâ”€â”€ models.py
â”‚   â”œâ”€â”€ views.py               # Home + endpoints (anÃ¡lisis, historial, pdf)
â”‚   â”œâ”€â”€ views_auth.py          # Login, registro, perfil, upgrade
â”‚   â”œâ”€â”€ urls.py
â”‚   â””â”€â”€ templates/
â”œâ”€â”€ requirements.txt           # Dependencias
â”œâ”€â”€ Procfile                   # Comando de inicio (migraciones + collectstatic + gunicorn)
â”œâ”€â”€ runtime.txt                # VersiÃ³n de Python
â””â”€â”€ README.md
```

---

## ğŸ§ª Desarrollo local (rÃ¡pido)
1) Requisitos: Python 3.11

2) Instalar dependencias:
```bash
pip install -r requirements.txt
```

3) Migraciones y servidor local:
```bash
python manage.py migrate
python manage.py runserver
```

4) Acceso: `http://127.0.0.1:8000`

Opcional: crear superusuario
```bash
python manage.py createsuperuser
```

---

## ğŸ”‘ Variables de entorno
- SECRET_KEY: clave secreta de Django (obligatoria en producciÃ³n)
- DEBUG: "True"/"False" (en Railway se recomienda False)
- ALLOWED_HOSTS: dominios permitidos (opcional; en `DEBUG=True` se relaja)

Base de datos (opcional, si no se definen se usa SQLite automÃ¡ticamente):
- PGHOST, PGPORT, PGUSER, PGPASSWORD, PGDATABASE (Railway Postgres)
- o `DATABASE_URL`/`DB_HOST`/`DB_*` equivalentes

IA (opcional):
- Puedes ingresar tu API key de Gemini en la UI al realizar un anÃ¡lisis.

---

## ğŸš€ Deploy en Railway (recomendado)
Este repositorio ya estÃ¡ preparado para Railway.

### Pasos
1) En Railway, crea un proyecto y selecciona â€œDeploy from GitHub Repoâ€.
2) Conecta este repositorio y la rama que quieras desplegar.
3) Variables (Settings â†’ Variables):
   - `SECRET_KEY`: genera una clave segura
   - `DEBUG`: `False` (recomendado) o `True` para pruebas
   - Si quieres Postgres: aÃ±ade un servicio de PostgreSQL y Railway expondrÃ¡ `PG*`. Si NO aÃ±ades Postgres, la app usarÃ¡ SQLite automÃ¡ticamente (no necesitas setear nada).
4) Deploy. El `Procfile` ejecuta:
   - Migraciones
   - `collectstatic` (WhiteNoise sirve estÃ¡ticos)
   - Gunicorn (`config.wsgi:application`)
5) Abre el dominio de Railway.

### Notas importantes
- Archivos estÃ¡ticos: WhiteNoise estÃ¡ habilitado en `config/settings.py`.
- Base de datos:
  - Si existen variables `PG*`/`DATABASE_URL`, se usa PostgreSQL.
  - Si NO existen, se usa SQLite (simple para entornos sin DB administrada).
- Procfile ya corre `collectstatic` con `--noinput` y lanza Gunicorn.

### SoluciÃ³n de problemas en Railway
- â€œconnection refused 127.0.0.1:5432â€: o bien conecta un servicio de Postgres (y Railway inyectarÃ¡ `PG*`), o elimina cualquier variable `PG*` para usar SQLite.
- â€œPillow no instalado / ImageFieldâ€: ya estÃ¡ incluido `Pillow` en `requirements.txt`.
- â€œSTATICFILES_DIRS no existeâ€: ya estÃ¡ configurado para ser condicional; el warning no aparecerÃ¡ si no hay carpeta `static/`.

---

## ğŸŒ Deploy en otras plataformas

### Heroku
- Requisitos: tener `Procfile` (ya existe), `runtime.txt` (ya existe).
- Variables: `SECRET_KEY`, `DEBUG`, `ALLOWED_HOSTS`, y opcionales `PG*` si usas Heroku Postgres.
- Comando de inicio (Procfile):
  ```
  web: python manage.py migrate && python manage.py collectstatic --noinput && gunicorn config.wsgi:application --bind 0.0.0.0:$PORT
  ```
- WhiteNoise ya sirve los archivos estÃ¡ticos.

### Docker / VPS (Gunicorn + Nginx)
- Usa la imagen `python:3.11-slim`.
- Instala dependencias con `pip install -r requirements.txt`.
- Variables: define `SECRET_KEY`, `DEBUG=False`, `ALLOWED_HOSTS`, y configura Postgres o permite el fallback a SQLite.
- Comando de inicio:
  ```bash
  gunicorn config.wsgi:application --bind 0.0.0.0:8000 --workers 3
  ```
- Nginx como reverse proxy (opcional) sirviendo `/static/` desde `staticfiles/`.

### Render, Fly.io, etc.
- Start command: `gunicorn config.wsgi:application --bind 0.0.0.0:$PORT`
- Asegura variables (`SECRET_KEY`, `DEBUG`, base de datos) y que se ejecute `python manage.py migrate` y `python manage.py collectstatic --noinput` durante el build/deploy.

---

## ğŸ§  Funcionalidades clave
- AnÃ¡lisis bÃ¡sico y competitivo con IA (Google Gemini)
- AutenticaciÃ³n: login, registro, perfil, planes
- Historial personal y pÃºblico
- ExportaciÃ³n a PDF (ReportLab)
- WhiteNoise para estÃ¡ticos en producciÃ³n

Rutas principales:
- `/` (GET/POST): home y creaciÃ³n de anÃ¡lisis
- `/login/`, `/register/`, `/logout/`, `/profile/`, `/upgrade/`
- `/history/`, `/public-history/`
- `/download-pdf/<uuid>/`

---

## ğŸ” Troubleshooting comÃºn
- No puedo descargar PDF: revisa que el anÃ¡lisis exista y usa el enlace directo `/download-pdf/<id>/`.
- Error de DB en producciÃ³n: elimina variables `PG*` para usar SQLite o conecta el servicio Postgres.
- Error de estÃ¡ticos/CSS: verifica que `collectstatic` corra en el deploy (en Railway lo hace el `Procfile`).

---

## ğŸ“„ Licencia
MIT. Ver `LICENSE` si aplica.

## ğŸ‘¤ Autor
- Raul Pivet (@Sinsapiar1)

---

Si este proyecto te resulta Ãºtil, Â¡deja una estrella! â­